{% extends "base.html" %}

{% block title %}Email Validation Logs - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="admin-header">
        <h2>Email Validation Logs (Trigger Activity)</h2>
        <a href="{{ url_for('main.admin_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>

    <div class="admin-section">
        <p class="info-text">
            <strong>ðŸ“§ Email Validation System:</strong> This log shows all email validation attempts using database triggers and Python validation.
            Invalid emails are rejected before insertion into the database.
        </p>

        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Valid</th>
                    <th>Action Type</th>
                    <th>Message</th>
                    <th>Attempted At</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr class="{% if not log.is_valid %}invalid-email{% endif %}">
                    <td>{{ log.id }}</td>
                    <td><code>{{ log.email }}</code></td>
                    <td>
                        {% if log.is_valid %}
                            <span class="badge-success">âœ“ Valid</span>
                        {% else %}
                            <span class="badge-danger">âœ— Invalid</span>
                        {% endif %}
                    </td>
                    <td>{{ log.action_type.title() }}</td>
                    <td>{{ log.validation_message }}</td>
                    <td>{{ log.attempted_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">No email validation logs yet.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="stats-summary">
            <h3>Validation Summary</h3>
            <div class="stats-grid">
                <div class="stat-box">
                    <strong>Total Attempts:</strong> {{ logs|length }}
                </div>
                <div class="stat-box">
                    <strong>Valid Emails:</strong> {{ logs|selectattr('is_valid', 'equalto', True)|list|length }}
                </div>
                <div class="stat-box">
                    <strong>Invalid Emails:</strong> {{ logs|selectattr('is_valid', 'equalto', False)|list|length }}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.info-text {
    background-color: #e3f2fd;
    padding: 15px;
    border-radius: 5px;
    border-left: 4px solid var(--primary-color);
    margin-bottom: 20px;
}

code {
    background-color: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
}

.text-center {
    text-align: center;
    padding: 30px;
    color: var(--text-light);
}

.stats-summary {
    margin-top: 30px;
    padding: 20px;
    background-color: var(--light-bg);
    border-radius: 8px;
}

.stats-summary h3 {
    margin-bottom: 15px;
    color: var(--text-dark);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.stat-box {
    background-color: white;
    padding: 15px;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
</style>
{% endblock %}